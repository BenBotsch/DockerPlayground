services:
  # -------------------------------------------------
  # Build service
  # -------------------------------------------------
  build:
    image: dockerplayground-linux
    build:
      context: .
      dockerfile: docker/linux/Dockerfile
    command: ["true"]

  # -------------------------------------------------
  # Test service
  # -------------------------------------------------
  test:
    image: dockerplayground-linux
    depends_on:
      - build
    volumes:
      - .:/workspace
      - conan-linux:/root/.conan2
      - build-linux:/workspace/build
    working_dir: /workspace
    command: ["bash", "-lc", "bash scripts/ci-linux.sh"]

  # -------------------------------------------------
  # Interactive shell (uses the built image)
  # -------------------------------------------------
  shell:
    image: dockerplayground-linux
    depends_on:
      - build
    volumes:
      - .:/workspace
      - conan-linux:/root/.conan2
      - build-linux:/workspace/build
    working_dir: /workspace
    tty: true
    stdin_open: true
    command: ["bash"]

volumes:
  conan-linux:
  build-linux:

